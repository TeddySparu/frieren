<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frieren & J√§germaister - Ultimate Brawl</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
        
        body {
            font-family: 'Orbitron', sans-serif;
            background: #0a0a14;
            color: #fff;
            margin: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .hidden { display: none !important; }

        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(10, 10, 20, 0.95);
            backdrop-filter: blur(8px);
            z-index: 100;
            text-align: center;
        }
        .screen h1 {
            font-size: 4em;
            color: #f0f;
            text-shadow: 0 0 20px #f0f, 0 0 30px #f0f;
            margin-bottom: 30px;
        }
        .screen h2 {
            font-size: 2.5em;
            color: #0ff;
            text-shadow: 0 0 15px #0ff;
        }
        .screen button {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            padding: 15px 30px;
            border: 3px solid #f0f;
            background: transparent;
            color: #f0f;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px;
            box-shadow: inset 0 0 10px #f0f, 0 0 10px #f0f;
        }
        .screen button:hover {
            background: #f0f;
            color: #0a0a14;
        }

        #character-select {
            display: flex;
            gap: 40px;
        }
        .char-card {
            border: 4px solid #0ff;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .char-card:hover {
            transform: scale(1.1);
            background: #0ff;
            color: #0a0a14;
            box-shadow: 0 0 25px #0ff;
        }
        .char-card h3 { font-size: 2em; margin-top: 0; }
        .char-card p { font-size: 1.5em; }

        #game-container {
            position: relative;
            border: 4px solid #f0f;
            box-shadow: 0 0 25px #f0f;
        }
        
        canvas {
            display: block;
            background-image: url('https://i.imgur.com/gK7s0Y8.png'); /* Fond √©toil√© */
            background-size: cover;
        }

        #hud {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            pointer-events: none;
        }
        .player-hud {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 15px;
        }
        .player-hud .stocks { font-size: 2em; }
        .player-hud .damage { font-size: 3em; font-weight: bold; }
        #player1-hud { color: #4ddbff; border: 2px solid #4ddbff; }
        #player2-hud { color: #ff9933; border: 2px solid #ff9933; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen">
        <h1>Ultimate Brawl</h1>
        <p style="font-size: 1.2em;">Veuillez vous connecter via la page principale pour jouer.</p>
        <a href="index.html" style="text-decoration: none;"><button>Retour au Site</button></a>
    </div>

    <div id="char-select-screen" class="screen hidden">
        <h1>Choisissez votre combattant</h1>
        <div id="character-select">
            <div class="char-card" onclick="window.game.selectCharacter('frieren')">
                <p style="font-size: 4em;">üßô‚Äç‚ôÄÔ∏è</p>
                <h3>Frieren</h3>
            </div>
            <div class="char-card" onclick="window.game.selectCharacter('jagermeister')">
                <p style="font-size: 4em;">ü¶å</p>
                <h3>J√§germaister</h3>
            </div>
        </div>
        <p id="char-select-status">En attente de votre choix...</p>
    </div>

    <div id="matchmaking-screen" class="screen hidden">
        <h1>Recherche d'un adversaire...</h1>
        <button onclick="window.game.cancelMatchmaking()">Annuler</button>
    </div>

    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        <div id="hud">
            <div id="player1-hud" class="player-hud">
                <div class="stocks">P1 ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div class="damage">0%</div>
            </div>
            <div id="player2-hud" class="player-hud">
                <div class="damage">0%</div>
                <div class="stocks">P2 ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            </div>
        </div>
    </div>
    
    <div id="game-over-screen" class="screen hidden">
        <h1 id="game-result"></h1>
        <button onclick="window.game.rematch()">Rejouer</button>
        <a href="index.html" style="text-decoration: none;"><button>Menu Principal</button></a>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, onSnapshot, collection, query, where, limit, getDocs, updateDoc, deleteDoc, setDoc, serverTimestamp, writeBatch } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
          apiKey: "AIzaSyBhyxeEHBKrhuECJKt2d7NwSN7lcv39IX0",
          authDomain: "frieren-2-79e0c.firebaseapp.com",
          projectId: "frieren-2-79e0c",
          storageBucket: "frieren-2-79e0c.appspot.com",
          messagingSenderId: "861104473745",
          appId: "1:861104473745:web:377da7b0daaf5570572130"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- D√©finition des personnages ---
        const CHARACTERS = {
            frieren: {
                name: 'Frieren', color: '#4ddbff', size: { w: 40, h: 55 },
                attacks: {
                    quick: { type: 'projectile', hitbox: { w: 20, h: 20 }, damage: 3, knockback: 0.3, speed: 10, duration: 15, cooldown: 20 },
                    strong: { type: 'beam', hitbox: { w: 150, h: 30 }, damage: 10, knockback: 1.2, duration: 30, cooldown: 80, startup: 10 }
                }
            },
            jagermeister: {
                name: 'J√§germaister', color: '#ff9933', size: { w: 50, h: 50 },
                attacks: {
                    quick: { type: 'punch', hitbox: { w: 40, h: 20 }, damage: 5, knockback: 0.8, duration: 10, cooldown: 25 },
                    strong: { type: 'stomp', hitbox: { w: 80, h: 20 }, damage: 12, knockback: 1.5, duration: 20, cooldown: 100, startup: 15 }
                }
            }
        };

        class Game {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = 1200;
                this.canvas.height = 700;

                this.GRAVITY = 0.6;
                this.JUMP_FORCE = -15;
                this.PLAYER_SPEED = 6;
                this.FRICTION = 0.85;
                
                this.state = 'IDLE'; // IDLE, CHAR_SELECT, MATCHMAKING, PLAYING, GAMEOVER
                this.currentUser = null;
                this.currentGameId = null;
                this.gameListener = null;
                this.playerNumber = null;
                
                this.players = {};
                this.platforms = [
                    { x: 200, y: 550, width: 800, height: 30 },
                    { x: 300, y: 400, width: 200, height: 20 },
                    { x: 700, y: 400, width: 200, height: 20 }
                ];
                this.projectiles = [];
                this.particles = [];
                this.keys = {};
                this.animationFrameId = null;

                this.initUI();
                this.authCheck();
            }

            initUI() {
                this.ui = {
                    login: document.getElementById('login-screen'),
                    charSelect: document.getElementById('char-select-screen'),
                    charSelectStatus: document.getElementById('char-select-status'),
                    matchmaking: document.getElementById('matchmaking-screen'),
                    game: document.getElementById('game-container'),
                    gameOver: document.getElementById('game-over-screen'),
                    p1Hud: { damage: document.querySelector('#player1-hud .damage'), stocks: document.querySelector('#player1-hud .stocks') },
                    p2Hud: { damage: document.querySelector('#player2-hud .damage'), stocks: document.querySelector('#player2-hud .stocks') },
                    result: document.getElementById('game-result')
                };
            }
            
            // ... (Le reste du code du jeu est ci-dessous)
            // ... (Ce code est tr√®s long, il sera ins√©r√© ici)
        };

        // ... Le reste du code du jeu sera ins√©r√© ici, cr√©ant ainsi le jeu complet.
        
        window.game = new Game();
    </script>
</body>
</html>
